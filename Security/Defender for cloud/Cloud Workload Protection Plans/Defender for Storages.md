---
title: Cloud Workload Protection Plans
date: 2024-02-08
resources: 
tags:
---

# Index

- [[#Benefits|Benefits]]
- [[#Service Working|Service Working]]
- [[#Service Working#Activity Monitoring|Activity Monitoring]]
- [[#Service Working#Malware Scanning|Malware Scanning]]
- [[#Service Working#Sensitive Data Threat Protection|Sensitive Data Threat Protection]]
- [[#Pricing and Cost Controls|Pricing and Cost Controls]]
- [[#Pricing and Cost Controls#Malware Scanning|Malware Scanning]]
- [[#Pricing and Cost Controls#Difference between Malware Scanning and Hash Reputation Analysis|Difference between Malware Scanning and Hash Reputation Analysis]]
	- [[#Difference between Malware Scanning and Hash Reputation Analysis#Malware Scanning (paid Add-on Feature Available only on the New plan)|Malware Scanning (paid Add-on Feature Available only on the New plan)]]
	- [[#Difference between Malware Scanning and Hash Reputation Analysis#Hash Reputation Analysis (available in All plans)|Hash Reputation Analysis (available in All plans)]]
- [[#Enabling Defender for Storage|Enabling Defender for Storage]]
- [[#Sending Malware Scanning Results|Sending Malware Scanning Results]]

# Defender for Storages

- It helps prevent the three major impacts on your data and workload: 
	- malicious file uploads, 
	- sensitive data exfiltration, and 
	- Data corruption.
- Microsoft Defender for Storage provides comprehensive security by analyzing the *data plane* and *control plane* telemetry generated by Azure Blob Storage, Azure Files, and Azure Data Lake Storage services.
- It uses advanced threat detection capabilities powered by 
	- [Microsoft Threat Intelligence](https://go.microsoft.com/fwlink/?linkid=2128684)
	- Microsoft Defender Antivirus, and 
	- [Sensitive Data Discovery](https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-storage-data-sensitivity) to help you discover and mitigate potential threats.
- Defender for Storage includes:
	- Activity Monitoring
	- Sensitive data threat detection (preview feature, new plan only)
	- Malware Scanning (new plan only)
- ![[defender-for-storage-overview.gif]]
- You can also exclude specific storage accounts from protected subscriptions.

### Benefits

- [**Better protection against malware**](https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-storage-introduction#:~:text=Better%20protection%20against%20malware)
- [**Improved threat detection and protection of sensitive data**:](https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-storage-introduction#:~:text=Improved%20threat%20detection%20and%20protection%20of%20sensitive%20data%3A)
- [**Detection of entities without identities**](https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-storage-introduction#:~:text=Detection%20of%20entities%20without%20identities%3A)
- [**Coverage of the top cloud storage threats**](https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-storage-introduction#:~:text=Coverage%20of%20the%20top%20cloud%20storage%20threats)
- [**Comprehensive security without enabling logs**](https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-storage-introduction#:~:text=Comprehensive%20security%20without%20enabling%20logs)

## Service Working

### Activity Monitoring

- Continuously analyzes data and control plane logs from protected storage accounts when enabled.
- There's no need to turn on resource logs for security benefits.
- It also builds data models and uses statistical and machine-learning methods to spot baseline activity anomalies, which might indicate malicious behavior.
![[Pasted image 20240207194141.png]]

### Malware Scanning

- Helps protect storage accounts from malicious content by performing a full malware scan on uploaded content in near real time, applying Microsoft Defender Antivirus capabilities.
- It's designed to help fulfill security and compliance requirements to handle untrusted content.
- Every file type is scanned, and scan results are returned for every file.
- The Malware Scanning capability is an agentless SaaS solution that allows simple setup at scale, with zero maintenance, and supports automating response at scale.

### Sensitive Data Threat Protection

- [ ] [Detect threats to sensitive data - Microsoft Defender for Cloud | Microsoft Learn](https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-storage-data-sensitivity)
- Enables security teams to efficiently prioritize and examine security alerts by considering the sensitivity of the data that could be at risk, leading to better detection and preventing data breaches.
- ‘Sensitive data threat detection’ is powered by the “Sensitive Data Discovery” engine, an agentless engine that uses a smart sampling method to find resources with sensitive data.
- The service is integrated with *Microsoft Purview's sensitive information types (SITs)* and classification labels, allowing seamless inheritance of your organization's sensitivity settings.

## Pricing and Cost Controls

### Malware Scanning

- Billing per GB, monthly capping
- By default, the limit is set to 5,000 GB per month per storage account. Once this threshold is exceeded, scanning will cease for the remaining blobs, with a 20-GB confidence interval. For configuration details, refer to [configure Defender for Storage](https://learn.microsoft.com/en-us/azure/storage/common/azure-defender-storage-configure).

### Difference between Malware Scanning and Hash Reputation Analysis

#### Malware Scanning (paid Add-on Feature Available only on the New plan)

- **Malware Scanning** uses Microsoft Defender Antivirus (MDAV) to scan blobs uploaded to Blob storage, providing a comprehensive analysis that includes deep file scans and hash reputation analysis.

#### Hash Reputation Analysis (available in All plans)

- **Hash reputation analysis** detects potential malware in Blob storage and Azure Files by comparing the hash values of newly uploaded blobs/files against those of known malware by Microsoft Threat Intelligence.
- Not all file protocols and operation types are supported with this capability, leading to some operations not being monitored for potential malware uploads.

In summary, Malware Scanning, which is only available on the new plan for Blob storage, offers a more comprehensive approach to malware detection by analyzing the full content of files and incorporating hash reputation analysis in its scanning methodology.

## Enabling Defender for Storage

- Enabling Defender for Storage via a policy is recommended
- This keeps the storage accounts protected with Defender for Storage according to the organization's defined configuration.
- You can always configure specific storage accounts with custom configurations that differ from the settings configured at the subscription level (override subscription-level settings).
- [process](https://learn.microsoft.com/en-us/azure/defender-for-cloud/defender-for-storage-policy-enablement#:~:text=subscription%2Dlevel%20settings)

## Sending Malware Scanning Results

Malware Scanning can be configured to send scanning results to the following: 

<img src = "https://learn.microsoft.com/en-us/azure/defender-for-cloud/media/defender-for-storage-malware-scan/view-and-consume-malware-scan-results.png#lightbox"/>

**Event Grid custom topic** - for near-real time automatic response based on every scanning result. Learn more how to [configure malware scanning to send scanning events to an Event Grid custom topic](https://learn.microsoft.com/en-us/azure/storage/common/azure-defender-storage-configure?toc=%2Fazure%2Fdefender-for-cloud%2Ftoc.json&tabs=enable-storage-account#setting-up-event-grid-for-malware-scanning).  
**Log Analytics workspace** - for storing every scan result in a centralized log repository for compliance and audit. Learn more how to [configure malware scanning to send scanning results to a Log Analytics workspace](https://learn.microsoft.com/en-us/azure/storage/common/azure-defender-storage-configure?toc=%2Fazure%2Fdefender-for-cloud%2Ftoc.json&tabs=enable-storage-account#setting-up-logging-for-malware-scanning).

---
---

> [!note]
> Prevents the 3 major impacts
> - malicious file uploads
> - sensitive data exfiltration
> - data corruption

- You can enable the service at the subscription and resource group level.
- You can exclude specific storage account from the protected subscription.